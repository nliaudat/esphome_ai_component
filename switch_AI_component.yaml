switch:      
  - platform: template
    name: "Pause AI processing"
    id: ${id_prefix}_pause_ai_processing
    icon: "mdi:pause"
    entity_category: config
    optimistic: true
    restore_mode: RESTORE_DEFAULT_OFF
    turn_on_action:
      - lambda: |-
          if (id(${id_prefix}_meter_reader) != nullptr) {
            id(${id_prefix}_meter_reader)->set_pause_processing(true);
          }
    turn_off_action:
      - lambda: |-
          if (id(${id_prefix}_meter_reader) != nullptr) {
            id(${id_prefix}_meter_reader)->set_pause_processing(false);
          }

  - platform: template
    name: "Setup Mode (Preview)"
    id: ${id_prefix}_setup_mode_preview
    icon: "mdi:camera-cog"
    entity_category: config
    optimistic: true
    restore_mode: RESTORE_DEFAULT_OFF
    turn_on_action:
      - lambda: |-
          if (id(${id_prefix}_meter_reader) != nullptr) {
            id(${id_prefix}_meter_reader)->set_generate_preview(true);
          }
    turn_off_action:
      - lambda: |-
          if (id(${id_prefix}_meter_reader) != nullptr) {
            id(${id_prefix}_meter_reader)->set_generate_preview(false);
          }

  - platform: template
    name: "Allow Negative Rates"
    id: ${id_prefix}_allow_negative_rates_switch
    icon: "mdi:minus-circle-off"
    entity_category: config
    optimistic: true
    restore_mode: RESTORE_DEFAULT_OFF
    turn_on_action:
      - lambda: |-
          if (id(${id_prefix}_validator) != nullptr) {
            id(${id_prefix}_validator)->set_allow_negative_rates(true);
          }
    turn_off_action:
      - lambda: |-
          if (id(${id_prefix}_validator) != nullptr) {
            id(${id_prefix}_validator)->set_allow_negative_rates(false);
          }

  # - platform: template
  #   name: "Debug Memory"
  #   id: ${id_prefix}_debug_memory_switch
  #   icon: "mdi:memory"
  #   entity_category: diagnostic
  #   optimistic: true
  #   restore_mode: RESTORE_DEFAULT_ON # Assuming default enabled via yaml
  #   turn_on_action:
  #     - lambda: |-
  #         #ifdef DEBUG_METER_READER_MEMORY
  #           if (id(${id_prefix}_meter_reader) != nullptr) {
  #             id(${id_prefix}_meter_reader)->set_debug_memory_enabled(true);
  #           }
  #         #endif
  #   turn_off_action:
  #     - lambda: |-
  #         #ifdef DEBUG_METER_READER_MEMORY
  #           if (id(${id_prefix}_meter_reader) != nullptr) {
  #             id(${id_prefix}_meter_reader)->set_debug_memory_enabled(false);
  #           }
  #         #endif

  # - platform: template
  #   name: "Component Debug Mode"
  #   id: ${id_prefix}_component_debug_mode_switch
  #   icon: "mdi:bug"
  #   entity_category: diagnostic
  #   optimistic: true
  #   restore_mode: RESTORE_DEFAULT_ON
  #   turn_on_action:
  #     - lambda: |-
  #         #ifdef DEBUG_METER_READER_TFLITE
  #           if (id(${id_prefix}_meter_reader) != nullptr) {
  #              id(${id_prefix}_meter_reader)->set_debug_mode(true);
  #           }
  #         #endif
  #   turn_off_action:
  #     - lambda: |-
  #          #ifdef DEBUG_METER_READER_TFLITE
  #            if (id(${id_prefix}_meter_reader) != nullptr) {
  #               id(${id_prefix}_meter_reader)->set_debug_mode(false);
  #            }
  #          #endif
           
  # - platform: template
  #   name: "Debug Timing"
  #   id: ${id_prefix}_debug_timing_switch
  #   icon: "mdi:clock-fast"
  #   entity_category: diagnostic
  #   optimistic: true
  #   restore_mode: RESTORE_DEFAULT_OFF
  #   turn_on_action:
  #     - lambda: |-
  #         #ifdef DEBUG_METER_READER_TIMING
  #           if (id(${id_prefix}_meter_reader) != nullptr) {
  #              id(${id_prefix}_meter_reader)->set_debug_timing(true);
  #           }
  #         #endif
  #   turn_off_action:
  #     - lambda: |-
  #          #ifdef DEBUG_METER_READER_TIMING
  #            if (id(${id_prefix}_meter_reader) != nullptr) {
  #               id(${id_prefix}_meter_reader)->set_debug_timing(false);
  #            }
  #          #endif

  # - platform: template
  #   name: "Camera Window Enabled"
  #   id: ${id_prefix}_camera_window_enabled_switch
  #   icon: "mdi:crop-free"
  #   entity_category: config
  #   optimistic: true
  #   restore_mode: RESTORE_DEFAULT_OFF
  #   turn_on_action:
  #     - lambda: |-
  #         if (id(${id_prefix}_meter_reader) != nullptr) {
  #           id(${id_prefix}_meter_reader)->set_camera_window_configured(true);
  #         }
  #   turn_off_action:
  #     - lambda: |-
  #         if (id(${id_prefix}_meter_reader) != nullptr) {
  #           id(${id_prefix}_meter_reader)->set_camera_window_configured(false);
  #         }

# button:
#   - platform: template
#     name: "Force AI inference"
#     id: ${id_prefix}_force_ai_inference
#     icon: "mdi:arrow-top-bold-hexagon-outline"
#     on_press:
#       - lambda: |-
#           if (id(${id_prefix}_meter_reader) != nullptr) {
#             id(${id_prefix}_meter_reader)->force_flash_inference(); 
#           }
